<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ARCHIVE ME - Google Sheets Data</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      cursor: pointer;
      background-color: #f2f2f2;
    }
    #search {
      margin: 10px 0;
      padding: 5px;
      width: 200px;
    }
  </style>
</head>
<body>
  <h1>üìä Google Sheets Ïó∞Îèô + Í≤ÄÏÉâ/Ï†ïÎ†¨ (JSON API)</h1>
  <input type="text" id="search" placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†•..." />
  <div id="output"></div>

  <script>
    // ‚ö†Ô∏è Ïó¨Í∏∞ sheetIDÏôÄ gid Í∞íÏùÑ ÎÑàÏùò ÏãúÌä∏Ïóê ÎßûÍ≤å Î∞îÍøîÏïº Ìï®
    const sheetID = "1tTQRUQJsCtEKFXSrPprfCCc9-V8seIHaGwPCbFktOrQ";  
    const gid = "0";  // Î≥¥ÌÜµ Ï≤´ Î≤àÏß∏ ÏãúÌä∏Îäî 0
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?gid=${gid}&tqx=out:json`;

    let allRows = [];

    fetch(url)
      .then(res => res.text())
      .then(data => {
        // JSON Ï∂îÏ∂ú
        const json = JSON.parse(data.substr(47).slice(0, -2));

        // Ìó§Îçî Ï∂îÏ∂ú
        const headers = json.table.cols.map(col => col.label);

        // Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
        const rows = json.table.rows.map(row =>
          row.c.map(cell => (cell ? cell.v : ""))
        );

        allRows = [headers, ...rows];
        renderTable(allRows);
      });

    // Ìëú Î†åÎçîÎßÅ
    function renderTable(rows) {
      let table = "<table><thead><tr>";
      rows[0].forEach((header, index) => {
        table += `<th onclick="sortTable(${index})">${header} ‚¨ç</th>`;
      });
      table += "</tr></thead><tbody>";

      rows.slice(1).forEach(row => {
        table += "<tr>";
        row.forEach(cell => {
          table += `<td>${cell}</td>`;
        });
        table += "</tr>";
      });

      table += "</tbody></table>";
      document.getElementById("output").innerHTML = table;
    }

    // Í≤ÄÏÉâ Í∏∞Îä•
    document.getElementById("search").addEventListener("input", function() {
      const keyword = this.value.toLowerCase();
      const filtered = allRows.filter((row, idx) => {
        if (idx === 0) return true; // Ìó§Îçî Ïú†ÏßÄ
        return row.some(cell => cell.toString().toLowerCase().includes(keyword));
      });
      renderTable(filtered);
    });

    // Ï†ïÎ†¨ Í∏∞Îä•
    let sortDirection = true;
    function sortTable(colIndex) {
      const header = allRows[0];
      let body = allRows.slice(1);

      body.sort((a, b) => {
        let valA = a[colIndex].toString().toLowerCase();
        let valB = b[colIndex].toString().toLowerCase();
        if (!isNaN(valA) && !isNaN(valB)) {
          return sortDirection ? valA - valB : valB - valA;
        }
        return sortDirection ? valA.localeCompare(valB) : valB.localeCompare(valA);
      });

      sortDirection = !sortDirection;
      renderTable([header, ...body]);
    }
  </script>
</body>
</html>

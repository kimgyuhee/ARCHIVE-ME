<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íšŒì›ì •ë³´ ì¡°íšŒ</title>
<style>
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { cursor: pointer; background-color: #f2f2f2; }
  #search { margin: 10px 0; padding: 5px; width: 200px; }
</style>
</head>
<body>
<h1>ğŸ“Š íšŒì›ì •ë³´ ì¡°íšŒ (ì‹¤ì‹œê°„)</h1>
<input type="text" id="search" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." />
<div id="output"></div>

<script>
  // âš ï¸ êµ¬ê¸€ ì‹œíŠ¸ ê³µê°œ URL ì‚¬ìš©
  const sheetID = "1tTQRUQJsCtEKFXSrPprfCCc9-V8seIHaGwPCbFktOrQ";      // êµ¬ê¸€ ì‹œíŠ¸ ID
  const gid = "0";                       // member ì‹œíŠ¸ íƒ­ ID
  const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?gid=${gid}&tqx=out:json`;

  let allRows = [];

  // êµ¬ê¸€ ì‹œíŠ¸ JSON API í˜¸ì¶œ
  fetch(url)
    .then(res => res.text())
    .then(data => {
      const json = JSON.parse(data.substr(47).slice(0,-2));
      const headers = json.table.cols.map(col => col.label);
      const rows = json.table.rows.map(row => row.c.map(cell => cell ? cell.v : ""));
      allRows = [headers, ...rows];
      renderTable(allRows);
    });

  function renderTable(rows) {
    let table = "<table><thead><tr>";
    rows[0].forEach((header, idx) => {
      table += `<th onclick="sortTable(${idx})">${header} â¬</th>`;
    });
    table += "</tr></thead><tbody>";

    rows.slice(1).forEach(row => {
      table += "<tr>";
      row.forEach(cell => table += `<td>${cell}</td>`);
      table += "</tr>";
    });

    table += "</tbody></table>";
    document.getElementById("output").innerHTML = table;
  }

  // ê²€ìƒ‰
  document.getElementById("search").addEventListener("input", function() {
    const keyword = this.value.toLowerCase();
    const filtered = allRows.filter((row, idx) => {
      if(idx===0) return true; // í—¤ë” ìœ ì§€
      return row.some(cell => cell.toString().toLowerCase().includes(keyword));
    });
    renderTable(filtered);
  });

  // ì •ë ¬
  let sortDirection = true;
  function sortTable(colIndex) {
    const header = allRows[0];
    let body = allRows.slice(1);

    body.sort((a,b) => {
      let valA = a[colIndex].toString().toLowerCase();
      let valB = b[colIndex].toString().toLowerCase();
      if(!isNaN(valA) && !isNaN(valB)) return sortDirection ? valA-valB : valB-valA;
      return sortDirection ? valA.localeCompare(valB) : valB.localeCompare(valA);
    });

    sortDirection = !sortDirection;
    renderTable([header, ...body]);
  }
</script>
</body>
</html>
